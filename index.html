<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Police Tech Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #0d1b2a;
    color: #f8f9fa;
    margin: 0;
    padding: 0;
  }
  header {
    background-color: #142d4c;
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  header h1 {
    font-size: 1.8rem;
    font-weight: 700;
  }
  .summary {
    display: flex;
    gap: 40px;
    align-items: center;
  }
  .summary-item {
    background-color: #1b3b6f;
    padding: 10px 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  }
  .summary-item span {
    display: block;
    font-size: 1.2rem;
    font-weight: bold;
    color: #ffd700;
  }
  .container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    padding: 40px;
  }
  .card {
    background-color: #1e3a5f;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }
  .card h2 {
    margin-top: 0;
    color: #ffd700;
    font-size: 1.3rem;
  }
  .slider-group {
    margin: 15px 0;
  }
  input[type="range"] {
    width: 100%;
    margin-top: 5px;
    accent-color: #ffd700;
  }
  #crimeChart {
    width: 100%;
    height: 350px !important;
  }
  .btn-generate {
    display: inline-block;
    background-color: #ffd700;
    color: #142d4c;
    font-weight: bold;
    padding: 12px 24px;
    margin-top: 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s ease;
  }
  .btn-generate:hover {
    background-color: #f4c10f;
  }
</style>
</head>
<body>

<header>
  <h1>Rochester Police Tech Dashboard</h1>
  <div class="summary">
    <div class="summary-item">
      Estimated Cost
      <span id="costDisplay">$0</span>
    </div>
    <div class="summary-item">
      Projected Crime Reduction
      <span id="reductionDisplay">0%</span>
    </div>
  </div>
</header>

<div class="container">
  <div class="card">
    <h2>Intervention Controls</h2>
    <div class="slider-group">
      <label>Patrol Officers: <span id="patrolVal">0</span></label>
      <input type="range" id="patrol" min="0" max="20" value="0" oninput="updateAll()">
    </div>
    <div class="slider-group">
      <label>Community Service Officers: <span id="csoVal">0</span></label>
      <input type="range" id="cso" min="0" max="20" value="0" oninput="updateAll()">
    </div>
    <div class="slider-group">
      <label>Street Lighting Increase (%): <span id="lightingVal">0</span></label>
      <input type="range" id="lighting" min="0" max="50" value="0" oninput="updateAll()">
    </div>
    <div class="slider-group">
      <label>Liquor Stores Change (%): <span id="liquorVal">0</span></label>
      <input type="range" id="liquor" min="-50" max="50" value="0" oninput="updateAll()">
    </div>
    <div class="slider-group">
      <label>Food Stores Change (%): <span id="foodVal">0</span></label>
      <input type="range" id="food" min="0" max="50" value="0" oninput="updateAll()">
    </div>
    <button class="btn-generate" onclick="generateProposal()">Generate Proposal PDF</button>
  </div>

  <div class="card">
    <h2>Projected Crime Outcomes</h2>
    <canvas id="crimeChart"></canvas>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const baseData = {
  violent: 120,
  property: 350,
  disorder: 220
};

function getImpactScores(values) {
  let violent = baseData.violent;
  let property = baseData.property;
  let disorder = baseData.disorder;

  violent *= 1 - (values.patrol * 0.005 + values.lighting * 0.002 - values.liquor * 0.004 + values.food * 0.003);
  property *= 1 - (values.patrol * 0.007 + values.cso * 0.004 + values.lighting * 0.002 - values.liquor * 0.005 + values.food * 0.003);
  disorder *= 1 - (values.patrol * 0.004 + values.cso * 0.008 + values.lighting * 0.004 - values.liquor * 0.006 + values.food * 0.004);

  return {
    violent: Math.max(violent, 0),
    property: Math.max(property, 0),
    disorder: Math.max(disorder, 0)
  };
}

function calculateCost(values) {
  let total = 0;
  total += values.patrol * 150000;
  total += values.cso * 100000;
  total += values.lighting * 2000;
  total += Math.abs(values.liquor) * 500;
  total += values.food * 1000;
  return total;
}

function updateAll() {
  const patrol = +document.getElementById('patrol').value;
  const cso = +document.getElementById('cso').value;
  const lighting = +document.getElementById('lighting').value;
  const liquor = +document.getElementById('liquor').value;
  const food = +document.getElementById('food').value;

  document.getElementById('patrolVal').innerText = patrol;
  document.getElementById('csoVal').innerText = cso;
  document.getElementById('lightingVal').innerText = lighting + '%';
  document.getElementById('liquorVal').innerText = liquor + '%';
  document.getElementById('foodVal').innerText = food + '%';

  const values = { patrol, cso, lighting, liquor, food };
  const impacts = getImpactScores(values);
  const totalCost = calculateCost(values);

  const reduction = 100 - ((impacts.violent + impacts.property + impacts.disorder) /
    (baseData.violent + baseData.property + baseData.disorder)) * 100;

  document.getElementById('costDisplay').innerText = `$${totalCost.toLocaleString()}`;
  document.getElementById('reductionDisplay').innerText = `${reduction.toFixed(1)}%`;

  updateChart(impacts);
}

function updateChart(impacts) {
  const values = [impacts.violent, impacts.property, impacts.disorder];
  const colors = values.map((val, i) => {
    const base = Object.values(baseData)[i];
    const reduction = 1 - val / base;
    if (reduction >= 0.3) return '#00c853';
    if (reduction >= 0.1) return '#ffd600';
    return '#ff3d00';
  });
  chart.data.datasets[0].data = values;
  chart.data.datasets[0].backgroundColor = colors;
  chart.update();
}

function generateProposal() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  doc.text("Rochester Police Intervention Proposal", 20, 20);
  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");
  doc.text("This proposal outlines recommended interventions based on the Police Tech Dashboard analysis.", 20, 35);
  doc.text("Projected Crime Reduction and Estimated Cost reflect the interactive model inputs.", 20, 45);
  doc.save("Rochester_Police_Proposal.pdf");
}

const ctx = document.getElementById('crimeChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Violent Crime', 'Property Crime', 'Disorder Calls'],
    datasets: [{
      label: 'Crime Incidents',
      data: [baseData.violent, baseData.property, baseData.disorder],
      backgroundColor: ['#ff3d00', '#ff3d00', '#ff3d00']
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>

</body>
</html>
